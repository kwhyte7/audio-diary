{% extends "base.html" %}

{% block body %}
<div class="flex container column main center-all">
	<div class="top flex container center-all column">
		<h1>Overview</h1>
		<button onclick="createNewDocument()">New</button>
	</div>
	<div class="content flex container wrap">
	
	</div>
</div>
{% endblock %}

{% block script %}
<script>
const [newDocumentElement] = Array.from(document.querySelectorAll(".flex.container .flex button"));
const documentContainer = document.querySelector(".content");

async function getDocuments() {
	const response = await fetch("/documents");
	if (response.ok) {
		return await response.json()
	} else {
		alert("Get documents failed")
	}
}

function renderDocument(documentId, title, unixTime, description="") {
	const div = document.createElement("div");

	const titleElement = document.createElement("h1");
	titleElement.textContent = title;
	div.appendChild(titleElement);

	const date = document.createElement("h3");
	date.textContent = new Date(unixTime*1000).toString().slice(0,24);
	div.appendChild(date)

	if (description) {
		const desc = document.createElement("p");
		desc.textContent = description;
		div.appendChild(description);
	}

	const loadButton = document.createElement("button");
	loadButton.textContent = "Load Document";
	loadButton.onclick = () => {loadDocument(documentId)};
	div.appendChild(loadButton);

	div.onclick = () => {loadDocument(documentId)};

	

	documentContainer.appendChild(div);
}

async function updateDocuments() {
	documentContainer.innerHTML = "";

	const documents = await getDocuments();
	const documentIds = Object.keys(documents);
	// render
	for (let i = 0; i < documentIds.length; i ++) {
		documentId = documentIds[i];
		docData = documents[documentId];
		renderDocument(documentId, docData["name"], docData["last_modified"], docData["description"])
	}
}

function createNewDocument() {
	title = prompt("What is the new document's name");
	console.log(title);
}

function loadDocument(documentId) {
	console.log(documentId)
}

updateDocuments()
</script>
{% endblock %}
